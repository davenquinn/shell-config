#!/usr/bin/env zsh

# Migrate docker volumes from Colima to OrbStack

unset DOCKER_HOST
docker context use orbstack
vol_name=$1
colima="unix:///Users/Daven/.colima/docker.sock"

# Print the volume name and size that would be migrated
docker -H $colima volume inspect $vol_name | jq '.[]'

docker volume create --name $vol_name

# Tar the volume and pipe it to the new volume

docker -H $colima run --rm -v $vol_name:/from alpine tar -cC /from . \
| docker run --rm -i -v $vol_name:/to alpine tar -xC /to